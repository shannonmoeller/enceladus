<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover,width=device-width" />
<link rel="manifest" href="/manifest.json" />

<title>Enceladus</title>

<script type="module">
	import { clone, defineElement, refs } from 'https://code.shannonmoeller.com/dhtml/v1.0.0/dhtml.js';
	import { createGame } from './game.js';

	if ('serviceWorker' in navigator) {
		navigator.serviceWorker.register('/service.js');
	}

	function EnceladusApp(el) {
		const { lobby, start, game, pause } = refs(el);

		start.onclick = () => {
			lobby.classList.add('closed');
			game.classList.remove('closed');
			game.start();
		};

		pause.onclick = () => {
			lobby.classList.remove('closed');
			game.classList.add('closed');
			game.pause();
		};
	}

	function EnceladusGame(el) {
		const view = clone('gameView');
		const { scene, left, right } = refs(view);

		const game = createGame(scene);

		el.start = game.start;
		el.pause = game.pause;

		left.onpointerdown = () => {
			game.left = true;
		}

		left.onpointerup = () => {
			game.left = false;
		}

		right.onpointerdown = () => {
			game.right = true;
		}

		right.onpointerup = () => {
			game.right = false;
		}

		el.prepend(view);
	}

	defineElement('enceladus-app', EnceladusApp);
	defineElement('enceladus-game', EnceladusGame);
</script>

<style>
	@import url('https://fonts.googleapis.com/css2?family=Oxanium:wght@200&display=swap');

	:root {
		--primary: 162 100%;
		--transition-in: opacity 500ms ease-in, transform 500ms ease-in, visibility 0ms;
		--transition-out: opacity 500ms ease-in, transform 500ms ease-in, visibility 500ms;
	}

	*,
	*::before,
	*::after {
		-webkit-appearance: none;
		-moz-appearance: none;
		appearance: none;
		box-sizing: border-box;
		margin: unset;
		padding: unset;
		background: unset;
		border: unset;
		color: inherit;
		font: inherit;
		outline: unset;
		text-decoration: unset;
	}

	html,
	body {
		height: 100%;
		width: 100%;
		overflow: hidden;
		-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
		touch-action: none;
		-webkit-touch-callout: none;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
	}

	html {
		font-size: 62.5%;
	}

	body {
		background-color: hsl(162 0% 6%);
		background-image:
			radial-gradient(circle farthest-side at 60% 330%, hsl(var(--primary) 50% / 80%), hsl(var(--primary) 50% / 0%) 75%),
			radial-gradient(circle farthest-side at 10% 320%, hsl(var(--primary) 50% / 40%), hsl(var(--primary) 50% / 0%) 75%),
			radial-gradient(circle farthest-side at 100% 320%, hsl(var(--primary) 50% / 20%), hsl(var(--primary) 50% / 0%) 75%),
			linear-gradient(to bottom, hsl(162 40% 0%), hsl(162 0% 1%) 20%, hsl(162 20% 8%) 95%, hsl(162 20% 10%));
		color: hsl(var(--primary) 80%);
		font: 200 2.4rem/1 "Oxanium", "Helvetica Neue", arial, sans-serif;
	}

	.lobby-title {
		display: inline-block;
		color: hsl(var(--primary) 8%);
		font-size: clamp(1.6rem, 13vw, 16rem);
		text-shadow:
			0 0 2px hsl(var(--primary) 8%),
			0px 2px 0 hsl(var(--primary) 40%),
			0px 2px 1px hsl(var(--primary) 40%),
			0px 2px 3px hsl(var(--primary) 10%),
			0px -1px 0 hsl(var(--primary) 0%);
	}

	@media (orientation: portrait) {
		.lobby-title {
			font-size: clamp(1.6rem, 16vw, 16rem);
		}
	}

	.button {
		cursor: pointer;
		padding: 0.25em 1em;
	}

	.button:focus {
		outline: 1px solid;
	}

	@supports selector(:focus-visible) {
		.button:focus {
			outline: 0;
		}

		.button:focus-visible {
			outline: 1px solid;
		}
	}

	.lobby {
		display: grid;
		place-content: center;
		place-items: center;
		gap: 1em;
		position: fixed;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		transform-origin: 50% 60%;
		transition: var(--transition-in);
	}

	.lobby.closed {
		opacity: 0;
		transform: scale(0.9);
		pointer-events: none;
		transition: var(--transition-out);
		visibility: hidden;
	}

	.game {
		position: fixed;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		transform-origin: 50% 40%;
		transition: var(--transition-in);
	}

	.game.closed {
		opacity: 0;
		transform: scale(1.1);
		pointer-events: none;
		transition: var(--transition-out);
		visibility: hidden;
	}

	.game-scene {
		position: absolute;
		top: 0;
		left: 0;
		height: 100%;
		width: 100%;
	}

	.game-left {
		position: absolute;
		top: 0;
		left: 0;
		height: 100%;
		width: 50%;
	}

	.game-right {
		position: absolute;
		top: 0;
		right: 0;
		height: 100%;
		width: 50%;
	}

	.game-pause {
		position: absolute;
		top: 0.5em;
		left: 50%;
		transform: translateX(-50%);
	}
</style>

<enceladus-app>
	<div class="lobby" ref="lobby">
		<h1 class="lobby-title">Enceladus</h1>
		<button class="button" ref="start">start</button>
	</div>

	<enceladus-game class="game closed" ref="game">
		<button class="button game-pause" ref="pause">pause</a>
	</enceladus-game>
</enceladus-app>

<template id="gameView">
	<canvas class="game-scene" ref="scene"></canvas>
	<button class="game-left" ref="left">left</button>
	<button class="game-right" ref="right">right</button>
</template>
